{% extends 'wishlist/_layouts' %}
{% set selectedSubnavItem = 'lists' %}

{% set crumbs = [
    { label: craft.wishlist.getPluginName() | t('wishlist'), url: url('wishlist') },
    { label: 'Lists' | t('wishlist'), url: url('wishlist/lists') },
    { label: list.title | t('wishlist'), url: list.getCpEditUrl() },
] %}

{% set title = item.title ?? 'Add item' %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% import '_includes/forms' as forms %}

{% block actionButton %}
    <div class="btngroup">
        <input type="submit" class="btn submit" value="{{ 'Save' | t('wishlist') }}">
        <div class="btn submit menubtn"></div>
        <div class="menu">
            <ul>
                <li>
                    <a class="formsubmit" data-redirect="{{ continueEditingUrl | hash }}">
                        {{ 'Save and continue editing' | t('wishlist') }}
                        {{ forms.optionShortcutLabel('S') }}
                    </a>
                </li>

                {% if item.id %}
                    <li>
                        <a class="formsubmit" data-param="itemId" data-value="" data-redirect="{{ continueEditingUrl | hash }}">
                            {{ 'Save as a new item' | t('wishlist') }}
                        </a>
                    </li>
                {% endif %}
            </ul>

            {% if item.id %}
                <hr>
                <ul>
                    <li>
                        <a class="formsubmit error" data-action="wishlist/items/delete" data-confirm="{{ 'Are you sure you want to delete this item?' | t('wishlist') }}" data-redirect="{{ list.getCpEditUrl() | hash }}">
                            {{ 'Delete' | t('wishlist') }}
                        </a>
                    </li>
                </ul>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block content %}
    <input type="hidden" name="action" value="wishlist/items/save-item">
    {{ redirectInput(list.getCpEditUrl()) }}
    <input type="hidden" name="listId" value="{{ list.id }}">
    {% if item.id %}<input type="hidden" name="itemId" value="{{ item.id }}">{% endif %}

    <div id="fields">
        {% if fieldsHtml | length %}
            {{ fieldsHtml | raw }}
        {% else %}
            <em>{{ 'No custom fields defined for this item type.' | t('wishlist') }}</em>
        {% endif %}
    </div>
{% endblock %}

{% block details %}
    <div class="meta">
        {{ forms.lightswitchField({
            label: 'Enabled' | t('wishlist'),
            id: 'enabled',
            name: 'enabled',
            on: item.enabled,
            first: true,
        }) }}

        {% set elementTypeOptions = [] %}

        {% for elementType in craft.wishlist.plugin.items.getSupportedElementTypes() %}
            {% set elementTypeOptions = elementTypeOptions | merge([{ label: displayName(elementType), value: elementType | kebab }]) %}
        {% endfor %}

        {% set itemElements = item.element ? [item.element] %}
        {% set itemElementType = (item.element ? className(item.element) : 'craft\\elements\\Entry') | kebab %}

        {{ forms.selectField({
            label: 'Element Type' | t('wishlist'),
            name: 'elementType',
            toggle: true,
            targetPrefix: '.element-type-',
            value: itemElementType,
            options: elementTypeOptions,
        }) }}

        {% for elementType in craft.wishlist.plugin.items.getSupportedElementTypes() %}
            {% set elementTypeId = elementType | kebab %}

            <div class="field element-type-{{ elementTypeId }} {{ itemElementType != elementType ? 'hidden' }}" data-attribute="{{ elementTypeId }}">
                <div class="heading">
                    <label id="{{ elementTypeId }}-label" for="{{ elementTypeId }}">
                        {{ 'Element' | t('wishlist') }}
                    </label>
                </div>

                <div class="input ltr">
                    {{ forms.elementSelect({
                        label: 'Element' | t('wishlist'),
                        id: elementTypeId,
                        name: 'elementId[' ~ (elementTypeId) ~ ']',
                        elementType: elementType,
                        elements: itemElementType == elementTypeId ? itemElements,
                        selectionLabel: "Choose" | t('app'),
                        limit: 1,
                        errors: item ? item.getErrors('elementId'),
                    }) }}
                </div>
            </div>
        {% endfor %}
    </div>

    {% if item.id %}
        <hr>

        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'Date Created' | t('wishlist') }}</h5>
                <div class="value">{{ item.dateCreated | date('short') }} {{ item.dateCreated | time('short') }}</div>
            </div>

            <div class="data">
                <h5 class="heading">{{ 'Date Updated' | t('wishlist') }}</h5>
                <div class="value">{{ item.dateUpdated | date('short') }} {{ item.dateUpdated | time('short') }}</div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% js %}

{% endjs %}