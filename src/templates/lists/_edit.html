{% extends 'wishlist/_layouts' %}
{% set selectedSubnavItem = 'lists' %}

{% set crumbs = [
    { label: craft.wishlist.getPluginName() | t('wishlist'), url: url('wishlist') },
    { label: 'Lists' | t('wishlist'), url: url('wishlist/lists') },
] %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% import '_includes/forms' as forms %}

{% block actionButton %}
    <div class="btngroup">
        <input type="submit" class="btn submit" value="{{ 'Save' | t('wishlist') }}">
        <div class="btn submit menubtn"></div>
        <div class="menu">
            <ul>
                <li>
                    <a class="formsubmit" data-redirect="{{ continueEditingUrl | hash }}">
                        {{ 'Save and continue editing' | t('wishlist') }}
                        {{ forms.optionShortcutLabel('S') }}
                    </a>
                </li>

                {% if list.id %}
                    <li>
                        <a class="formsubmit" data-action="elements/duplicate" data-params="{{ { elementId: list.id } | json_encode }}" data-redirect="{{ continueEditingUrl | hash }}">
                            {{ 'Save as a new list' | t('wishlist') }}
                        </a>
                    </li>
                {% endif %}
            </ul>

            {% if list.id %}
                <hr>
                <ul>
                    <li>
                        <a class="formsubmit error" data-action="wishlist/lists/delete" data-confirm="{{ 'Are you sure you want to delete this list?' | t('wishlist') }}" data-redirect="{{ 'wishlist/lists' | hash }}">
                            {{ 'Delete' | t('wishlist') }}
                        </a>
                    </li>
                </ul>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block content %}
    <input type="hidden" name="action" value="wishlist/lists/save-list">
    {{ redirectInput('wishlist/lists') }}
    <input type="hidden" name="typeId" value="{{ listType.id }}">
    {% if list.id %}<input type="hidden" name="listId" value="{{ list.id }}">{% endif %}

    <div id="fields">
        {% if fieldsHtml | length %}
            {{ fieldsHtml | raw }}
        {% else %}
            <em>{{ 'No custom fields defined for this list type.' | t('wishlist') }}</em>
        {% endif %}
    </div>

    <hr>

    <div id="items" class="">
        <h2>{{ 'List Items' | t('comments') }}</h2>

        {% set itemIds = [] %}

        {% for item in list.getItems() %}
            {% set itemIds = itemIds | merge([item.id]) %}
        {% endfor %}

        {% if list.id and itemIds %}
            <div id="elementindex-items" class="elementindex">
                <div class="main">
                    {% set elementType = 'verbb\\wishlist\\elements\\Item' %}
                    {% set elementInstance = craft.app.elements.createElement(elementType) %}
                    {% set context = 'index' %}
                    {% set sources = craft.app.elementSources.getSources(elementType, 'index') %}

                    <div class="element-toolbar flex flex-nowrap">
                        {% include '_elements/toolbar' with {
                            showSiteMenu: false,
                        } %}
                    </div>
                    
                    <div class="content-pane" style="margin-top: 24px; box-shadow: none; border: 1px #cdd8e4 solid;">
                        <div class="elements"></div>
                    </div>

                    <div class="sidebar">
                        <nav class="hidden">
                            {% include "_elements/sources" %}
                        </nav>
                    </div>
                </div>
            </div>

            {% js %}
                Craft.elementIndex = Craft.createElementIndex('{{ elementType|e("js") }}', $('#elementindex-items'), {
                    elementTypeName: '{{ elementInstance.displayName()|e("js") }}',
                    elementTypePluralName: '{{ elementInstance.pluralDisplayName()|e("js") }}',
                    context: '{{ context }}',
                    storageKey: 'elementindex.{{ elementType|e("js") }}',
                    criteria: { id: {{ itemIds | json_encode | raw }} },
                    toolbarSelector: '.element-toolbar',
                    canHaveDrafts: 'false',
                });
            {% endjs %}
        {% else %}
            <p><em>{{ 'No items in this list.' | t('wishlist') }}</em></p>
        {% endif %}

        <hr>

        <a class="btn formsubmit submit icon add" data-redirect="{{ url('wishlist/lists/' ~ list.type.handle ~ '/' ~ list.id ~ '/items/new') | hash }}">{{ 'Add item' }}</a>
    </div>
{% endblock %}

{% block details %}
    <div class="meta">
        {{ forms.lightswitchField({
            label: 'Enabled' | t('wishlist'),
            id: 'enabled',
            name: 'enabled',
            on: list.enabled,
            first: true,
        }) }}
    
        {{ forms.elementSelectField({
            label: 'User' | t('wishlist'),
            id: 'userId',
            name: 'userId',
            elementType: 'craft\\elements\\User',
            limit: 1,
            elements: (list.user is defined and list.user ? [list.user]),
        }) }}
    </div>

    {% if list.id %}
        <hr>

        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'List Type' | t('wishlist') }}</h5>
                <div class="value"><code>{{ list.type.name }}</code></div>
            </div>
        </div>

        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'Reference' | t('wishlist') }}</h5>
                <div class="value"><code>{{ list.reference }}</code></div>
            </div>
        </div>

        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'IP Address' | t('wishlist') }}</h5>
                <div class="value"><code>{{ list.lastIp }}</code></div>
            </div>
        </div>
        
        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'Owner Type' | t('wishlist') }}</h5>

                <div class="value">
                    {% if list.user %}
                        {{ 'User' | t('wishlist') }}
                    {% else %}
                        {{ 'Guest' | t('wishlist') }}
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="meta read-only">
            <div class="data">
                <h5 class="heading">{{ 'Date Created' | t('wishlist') }}</h5>
                <div class="value">{{ list.dateCreated | date('short') }} {{ list.dateCreated | time('short') }}</div>
            </div>

            <div class="data">
                <h5 class="heading">{{ 'Date Updated' | t('wishlist') }}</h5>
                <div class="value">{{ list.dateUpdated | date('short') }} {{ list.dateUpdated | time('short') }}</div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% css %}

#elementindex-items .sidebar {
    padding: 0;
    width: 100%;
    background: transparent;
}

#elementindex-items .sidebar .customize-sources {
    display: inline-block;
    margin: 1rem 0 0;
    padding: 0;
}

#elementindex-items .sidebar .customize-sources .label {
    opacity: 1;
}

{% endcss %}